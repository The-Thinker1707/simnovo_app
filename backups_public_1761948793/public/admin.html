<!doctype html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Admin — EduConnect</title><link rel="stylesheet" href="/styles.css"></head><body>
<div class="container">
  <header class="header"><div class="brand"><div class="logo">EDU ADMIN</div></div><nav class="top-nav"><a href="/portal.html">Portal</a><a class="cta" href="/auth/logout">Logout</a></nav></header>

  <div class="grid-2">
    <div class="card">
      <h3>Create User</h3>
      <form id="create-user" style="display:grid;gap:8px">
        <input name="name" placeholder="Full name" required/>
        <input name="email" placeholder="Email" type="email" required/>
        <input name="password" placeholder="Password" required/>
        <select name="role">
          <option value="teacher">Teacher</option><option value="parent">Parent</option><option value="student">Student</option>
        </select>
        <input name="extra" placeholder="childId / studentId (optional)"/>
        <button type="submit">Create</button>
      </form>
    </div>

    <div class="card">
      <h3>Link Parent → Student</h3>
      <form id="link-form" style="display:grid;gap:8px">
        <input name="parentEmail" placeholder="Parent email" required/>
        <input name="studentId" placeholder="Student ID (e.g. s-1)" required/>
        <button type="submit">Link</button>
      </form>
    </div>
  </div>

  <div style="margin-top:16px" class="card">
    <h3>Users</h3>
    <div id="users-list" class="note"></div>
  </div>
</div>
<div class="toast-wrap" id="toasts"></div>
<script>
function toast(m,t=3000){const w=document.getElementById('toasts');const e=document.createElement('div');e.className='toast';e.textContent=m;w.appendChild(e);setTimeout(()=>e.remove(),t)}
async function api(path,opts){const r=await fetch(path,opts); if(r.status===401){location.href='/portal.html'; return null} return r.json()}
async function loadUsers(){ const u=await api('/api/admin/users'); if(!u) return; document.getElementById('users-list').innerHTML = u.map(x=>`<div style="padding:8px;border-bottom:1px solid #f1f6fb"><b>${x.name}</b> — ${x.email} — ${x.role} ${x.childId?(' • child:'+x.childId):''} ${x.studentId?(' • student:'+x.studentId):''}</div>`).join(''); }
document.getElementById('create-user').onsubmit = async e=>{ e.preventDefault(); const f = new FormData(e.target); const body = { name:f.get('name'),email:f.get('email'),password:f.get('password'),role:f.get('role'),extra:f.get('extra')}; await fetch('/api/admin/users',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)}); toast('User created'); e.target.reset(); loadUsers(); };
document.getElementById('link-form').onsubmit = async e=>{ e.preventDefault(); const f=new FormData(e.target); const parent=f.get('parentEmail'), sid=f.get('studentId'); await fetch('/api/admin/link',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({parentEmail:parent,studentId:sid})}); toast('Linked'); e.target.reset(); loadUsers(); };
loadUsers();
</script>
</body></html>
