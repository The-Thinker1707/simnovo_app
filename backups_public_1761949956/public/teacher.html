<!doctype html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Teacher — EduConnect</title><link rel="stylesheet" href="/styles.css"></head><body>
  <div class="container">
    <header class="header"><div class="brand"><div class="logo">EDU</div></div><nav class="top-nav"><a href="/portal.html">Portal</a><a class="cta" href="/auth/logout">Logout</a></nav></header>

    <main>
      <div class="grid-3">
        <div class="card">
          <div class="profile">
            <div class="avatar" id="avatar"><img id="avatar-img" src="/assets/avatar.svg" alt="avatar"/></div>
            <div>
              <h3 id="name">Teacher Name</h3>
              <div class="note" id="email">teacher@example.com</div>
              <div class="note" id="phone"></div>
            </div>
          </div>
          <p class="note" id="bio" style="margin-top:10px">Teacher dashboard — lesson plans, results, fees, bloodbook and staff management.</p>
        </div>

        <div class="card">
          <h3>Announcements</h3>
          <ul id="ann-list" style="color:var(--muted)"></ul>
        </div>

        <div class="card">
          <h3>Quick Stats</h3>
          <div id="stats" class="row" style="margin-top:8px;gap:12px"></div>
        </div>
      </div>

      <div style="margin-top:16px" class="grid-2">
        <div class="card">
          <h3>Lesson Plans & Resources</h3>
          <div id="lessons" class="note"></div>
          <form id="lesson-form" style="margin-top:10px;display:grid;gap:8px">
            <input name="title" placeholder="Lesson title" required/>
            <input name="resource" placeholder="Resource URL"/>
            <button type="submit" class="small">Add Lesson</button>
          </form>
        </div>

        <div class="card">
          <h3>Results Entry</h3>
          <form id="result-form" style="display:grid;gap:8px">
            <input name="studentId" placeholder="Student ID (s-1)" required/>
            <input name="term" placeholder="Term (e.g. Term 3 2025)" required/>
            <input name="subject" placeholder="Subject" required/>
            <input name="grade" placeholder="Grade" required/>
            <button type="submit" class="small">Save Result</button>
          </form>
          <div id="results-list" style="margin-top:10px;color:var(--muted)"></div>
        </div>
      </div>

      <div style="margin-top:16px" class="card">
        <h3>Fees & Bloodbook</h3>
        <div id="fees" class="note"></div>
      </div>

      <div style="margin-top:16px" class="card">
        <h3>Edit Profile</h3>
        <form id="profile-form" enctype="multipart/form-data" style="display:grid;gap:8px">
          <input name="name" placeholder="Full name" required/>
          <input name="phone" placeholder="Phone"/>
          <label>Upload profile photo</label>
          <input type="file" name="photo" accept="image/*"/>
          <button type="submit" class="small">Update Profile</button>
        </form>
      </div>
    </main>
  </div>

<script>
async function api(path, opts){ const r = await fetch(path, opts); if(r.status===401){ location.href='/portal.html'; return null;} return r.json(); }
async function load(){
  const p = await api('/api/profile'); if(!p) return;
  document.getElementById('name').textContent = p.user.name || 'Teacher';
  document.getElementById('email').textContent = p.user.email || '';
  if(p.user.photo) document.getElementById('avatar-img').src = p.user.photo;
  document.getElementById('phone').textContent = p.user.phone||'';
  const ann = await api('/api/announcements'); document.getElementById('ann-list').innerHTML = (ann||[]).map(a=>`<li><strong>${a.title}</strong> — ${a.body}</li>`).join('');
  const lessons = await api('/api/lessons'); document.getElementById('lessons').innerHTML = (lessons||[]).map(l=>`<div><b>${l.title}</b><div class="note"><a href="${l.resource}" target="_blank">${l.resource}</a></div></div>`).join('');
  const fees = await api('/api/fees'); document.getElementById('fees').innerHTML = (fees||[]).map(f=>`<div>${f.studentId} • ${f.term} • $${f.amount} • ${f.status}</div>`).join('');
  const results = await api('/api/results'); document.getElementById('results-list').innerHTML = (results||[]).slice(-10).map(r=>`<div>${r.studentId} • ${r.term} • ${r.subject}: ${r.grade}</div>`).join('');

  document.getElementById('lesson-form').onsubmit = async e=>{ e.preventDefault(); const fd = new FormData(e.target); await fetch('/api/lessons',{method:'POST',headers:{'Content-Type':'application/json'},body: JSON.stringify({title:fd.get('title'), resource:fd.get('resource')})}); load(); };
  document.getElementById('result-form').onsubmit = async e=>{ e.preventDefault(); const fd=new FormData(e.target); await fetch('/api/teacher/results',{method:'POST',headers:{'Content-Type':'application/json'},body: JSON.stringify({studentId:fd.get('studentId'),term:fd.get('term'),subject:fd.get('subject'),grade:fd.get('grade')})}); load(); };
  document.getElementById('profile-form').onsubmit = async e=>{ e.preventDefault(); const form = e.target; const f = new FormData(form); await fetch('/api/profile',{method:'POST',body:f}); alert('Profile updated'); load(); };
}
load();
</script>
</body></html>
