<!doctype html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Teacher Dashboard</title><link rel="stylesheet" href="/styles.css"></head>
<body>
  <div class="container">
    <header class="header"><div class="brand"><div class="logo">EDU</div><div><div style="font-weight:800">EduConnect</div><div style="font-size:12px;color:#556074">Teacher</div></div></div><nav class="top-nav"><a href="/portal.html">Portal</a><a href="/auth/logout" class="cta">Logout</a></nav></header>

    <div class="grid">
      <div class="card">
        <div class="row"><div class="profile"><div class="avatar" id="avatar"><img id="avatar-img" src="/assets/avatar-placeholder.png" alt="avatar"></div><div><h3 id="t-name"></h3><small id="t-email" class="note"></small></div></div></div>
        <p id="t-bio" style="color:#556074"></p>
        <div style="margin-top:12px">
          <a href="#results"><button style="width:100%">Enter Results</button></a>
        </div>
      </div>

      <div class="card">
        <h3>Announcements</h3>
        <ul id="ann-list" style="margin:0;padding-left:18px;color:#556074"></ul>
      </div>

      <div class="card">
        <h3>Lesson Plans & Resources</h3>
        <div id="lessons"></div>
        <form id="add-lesson" style="margin-top:8px">
          <input name="title" placeholder="Lesson title" required>
          <input name="resource" placeholder="Resource link">
          <button type="submit">Add Lesson</button>
        </form>
      </div>

      <div class="card" id="results" style="grid-column:1/3">
        <h3>Results Entry</h3>
        <form id="add-result">
          <input name="studentId" placeholder="Student ID (e.g. s-1)" required>
          <input name="term" placeholder="Term (e.g. Term 3 2025)" required>
          <input name="subject" placeholder="Subject" required>
          <input name="grade" placeholder="Grade" required>
          <button type="submit">Save Result</button>
        </form>
        <div id="results-list" style="margin-top:12px"></div>
      </div>

      <div class="card">
        <h3>Staff Directory</h3>
        <div id="staff-list"></div>
      </div>

      <div class="card">
        <h3>Fees & Bloodbook</h3>
        <div id="fees-list"></div>
      </div>

      <div class="card">
        <h3>Edit Profile</h3>
        <form id="profile-form" enctype="multipart/form-data">
          <input name="name" placeholder="Full name" required>
          <input name="phone" placeholder="Phone">
          <label>Profile photo</label>
          <input type="file" name="photo" accept="image/*">
          <button type="submit">Update Profile</button>
        </form>
      </div>
    </div>

  </div>

<script>
async function api(path, opts){ const r = await fetch(path, opts); if(r.status===401){ location.href='/portal.html'; return; } return r.json(); }
async function load(){
  const p = await api('/api/profile'); if(!p) return;
  document.getElementById('t-name').textContent = p.user.name;
  document.getElementById('t-email').textContent = p.user.email;
  if(p.user.photo) document.getElementById('avatar-img').src = p.user.photo;

  const ann = await api('/api/announcements'); document.getElementById('ann-list').innerHTML = ann.map(a=>`<li><strong>${a.title}</strong> — ${a.body}</li>`).join('');
  const lessons = await api('/api/lessons'); document.getElementById('lessons').innerHTML = lessons.map(l=>`<div><b>${l.title}</b><div class="note"><a href="${l.resource}" target="_blank">${l.resource}</a></div></div>`).join('');
  const staff = await api('/api/staff'); document.getElementById('staff-list').innerHTML = staff.map(s=>`<div>${s.name} — ${s.role} • ${s.email}</div>`).join('');
  const fees = await api('/api/fees'); document.getElementById('fees-list').innerHTML = fees.map(f=>`<div>${f.studentId} — ${f.term} — $${f.amount} — ${f.status}</div>`).join('');
  const results = await api('/api/results'); document.getElementById('results-list').innerHTML = (results||[]).map(r=>`<div>${r.studentId} • ${r.term} • ${r.subject}: ${r.grade}</div>`).join('');

  // handlers
  document.getElementById('add-lesson').onsubmit = async e=>{
    e.preventDefault(); const fd = new FormData(e.target);
    await fetch('/api/lessons', {method:'POST', body: JSON.stringify({title:fd.get('title'), resource:fd.get('resource')}), headers:{'Content-Type':'application/json'}}); load();
  };
  document.getElementById('add-result').onsubmit = async e=>{
    e.preventDefault(); const fd=new FormData(e.target);
    await fetch('/api/teacher/results', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({studentId:fd.get('studentId'), term:fd.get('term'), subject:fd.get('subject'), grade:fd.get('grade')})});
    load();
  };
  document.getElementById('profile-form').onsubmit = async e=>{
    e.preventDefault(); const form = e.target; const f = new FormData(form);
    await fetch('/api/profile', {method:'POST', body:f}); alert('Profile updated'); load();
  };
}
load();
</script>
</body></html>
