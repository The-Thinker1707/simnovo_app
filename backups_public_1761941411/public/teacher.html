<!doctype html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Teacher — EduConnect</title>
<link rel="stylesheet" href="/styles.css">
<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head><body>
<div class="container">
  <header class="header"><div class="brand"><div class="logo">EDU</div></div><nav class="top-nav"><a href="/portal.html">Portal</a><a class="cta" href="/auth/logout">Logout</a></nav></header>

  <div class="grid-3">
    <div class="card">
      <div class="profile"><div class="avatar"><img id="avatar-img" src="/assets/avatar.svg"></div><div><h3 id="t-name">Teacher</h3><div class="note" id="t-email"></div></div></div>
      <p class="note" id="t-bio"></p>
    </div>

    <div class="card">
      <h3>Announcements</h3>
      <ul id="ann-list" class="note"></ul>
    </div>

    <div class="card">
      <h3>Analytics Snapshot</h3>
      <canvas id="chart-perf" width="300" height="180"></canvas>
    </div>
  </div>

  <div style="margin-top:16px" class="grid-2">
    <div class="card">
      <h3>Lessons & Resources</h3>
      <div id="lessons" class="note"></div>
      <form id="lesson-form" style="margin-top:8px;display:grid;gap:8px">
        <input name="title" placeholder="Lesson title" required/>
        <input name="resource" placeholder="Resource URL"/>
        <button type="submit" class="small">Add Lesson</button>
      </form>
    </div>

    <div class="card">
      <h3>Results Entry</h3>
      <form id="result-form" style="display:grid;gap:8px">
        <input name="studentId" placeholder="Student ID (s-1)" required/>
        <input name="term" placeholder="Term (e.g. Term 3 2025)" required/>
        <input name="subject" placeholder="Subject" required/>
        <input name="grade" placeholder="Grade" required/>
        <button type="submit" class="small">Save Result</button>
      </form>
      <div id="results-list" style="margin-top:10px;color:var(--muted)"></div>
    </div>
  </div>

  <div style="margin-top:16px" class="card">
    <h3>Edit Profile</h3>
    <form id="profile-form" enctype="multipart/form-data" style="display:grid;gap:8px">
      <input name="name" placeholder="Full name" required/>
      <input name="phone" placeholder="Phone"/>
      <label>Upload profile photo</label>
      <input type="file" name="photo" accept="image/*"/>
      <button type="submit" class="small">Update Profile</button>
    </form>
  </div>
</div>

<div class="toast-wrap" id="toasts"></div>

<script>
function toast(msg,t=3000){const w=document.getElementById('toasts');const e=document.createElement('div');e.className='toast';e.textContent=msg;w.appendChild(e);setTimeout(()=>e.remove(),t)}
async function api(path,opts){const r=await fetch(path,opts); if(r.status===401){location.href='/portal.html'; return null} return r.json()}
async function load(){
  const p=await api('/api/profile'); if(!p) return;
  document.getElementById('t-name').textContent=p.user.name; document.getElementById('t-email').textContent=p.user.email || '';
  if(p.user.photo) document.getElementById('avatar-img').src=p.user.photo;

  const ann=await api('/api/announcements'); document.getElementById('ann-list').innerHTML=(ann||[]).map(a=>`<li><strong>${a.title}</strong> — ${a.body}</li>`).join('');
  const lessons=await api('/api/lessons'); document.getElementById('lessons').innerHTML=(lessons||[]).map(l=>`<div><b>${l.title}</b><div class="note"><a href="${l.resource}" target="_blank">${l.resource}</a></div></div>`).join('');
  const results=await api('/api/results'); document.getElementById('results-list').innerHTML=(results||[]).slice(-10).map(r=>`<div>${r.studentId} • ${r.term} • ${r.subject}: ${r.grade}</div>`).join('');

  // chart: request /api/analytics and show simple grade distribution per subject (demo)
  const a = await api('/api/analytics');
  if(a){
    const ctx = document.getElementById('chart-perf').getContext('2d');
    const labels = a.gradeSummary.subjects.map(s=>s.name);
    const data = a.gradeSummary.subjects.map(s=>s.avgScore);
    // convert grade letters to pseudo-scores (A=90,B=80 etc.) already provided by server as avgScore
    new Chart(ctx, { type:'bar', data:{ labels, datasets:[{ label:'Avg Score (demo)', data, backgroundColor:['#0b76d1','#06b6d4','#ff7a59','#7c5cff']} ] }, options:{responsive:true,scales:{y:{beginAtZero:true,max:100}}}});
  }
  // handlers
  document.getElementById('lesson-form').onsubmit = async e=>{ e.preventDefault(); const fd = new FormData(e.target); await fetch('/api/lessons',{method:'POST',headers:{'Content-Type':'application/json'},body: JSON.stringify({title:fd.get('title'),resource:fd.get('resource')})}); toast('Lesson added'); load(); };
  document.getElementById('result-form').onsubmit = async e=>{ e.preventDefault(); const fd=new FormData(e.target); await fetch('/api/teacher/results',{method:'POST',headers:{'Content-Type':'application/json'},body: JSON.stringify({studentId:fd.get('studentId'),term:fd.get('term'),subject:fd.get('subject'),grade:fd.get('grade')})}); toast('Result saved'); load(); };
  document.getElementById('profile-form').onsubmit = async e=>{ e.preventDefault(); const f=new FormData(e.target); await fetch('/api/profile',{method:'POST',body:f}); toast('Profile updated'); load(); };
}
load();
</script>
</body></html>
