<!doctype html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Parent — EduConnect</title><link rel="stylesheet" href="/styles.css"></head><body>
  <div class="container">
    <header class="header"><div class="brand"><div class="logo">EDU</div></div><nav class="top-nav"><a href="/portal.html">Portal</a><a class="cta" href="/auth/logout">Logout</a></nav></header>
    <main>
      <div class="grid-3">
        <div class="card">
          <div class="profile"><div class="avatar"><img id="p-avatar" src="/assets/avatar.svg"></div><div><h3 id="p-name">Parent</h3><div class="note" id="p-email">parent@example.com</div></div></div>
          <p class="note" id="p-bio">Parent dashboard — view child progress, results and submit complaints.</p>
        </div>

        <div class="card">
          <h3>Child Results</h3>
          <div id="child-results" class="note"></div>
        </div>

        <div class="card">
          <h3>Announcements</h3>
          <ul id="p-ann" class="note"></ul>
        </div>
      </div>

      <div style="margin-top:16px" class="card">
        <h3>Submit Complaint / Suggestion</h3>
        <form id="complaint-form" style="display:grid;gap:8px">
          <textarea name="text" rows="4" placeholder="Enter complaint or suggestion" required></textarea>
          <button type="submit" class="small">Send</button>
        </form>
      </div>

      <div style="margin-top:16px" class="card">
        <h3>Edit Profile</h3>
        <form id="profile-form" enctype="multipart/form-data" style="display:grid;gap:8px">
          <input name="name" placeholder="Full name" required/>
          <input name="phone" placeholder="Phone"/>
          <label>Profile photo</label>
          <input type="file" name="photo" accept="image/*"/>
          <button type="submit" class="small">Update Profile</button>
        </form>
      </div>
    </main>
  </div>

<script>
async function api(path, opts){ const r = await fetch(path, opts); if(r.status===401){ location.href='/portal.html'; return null;} return r.json(); }
async function load(){
  const p = await api('/api/profile'); if(!p) return;
  document.getElementById('p-name').textContent = p.user.name || '';
  document.getElementById('p-email').textContent = p.user.email || '';
  if(p.user.photo) document.getElementById('p-avatar').src = p.user.photo;
  const dash = await api('/api/parent/dashboard'); document.getElementById('child-results').innerHTML = (dash.results||[]).map(r=>`<div><b>${r.term}</b><ul>${(r.subjects||[]).map(s=>`<li>${s.name}: ${s.grade}</li>`).join('')}</ul></div>`).join('');
  document.getElementById('p-ann').innerHTML = (dash.announcements||[]).map(a=>`<li>${a.title} — ${a.body}</li>`).join('');
  document.getElementById('complaint-form').onsubmit = async e=>{ e.preventDefault(); const text=e.target.elements['text'].value; await fetch('/api/parent/complaint',{method:'POST',headers:{'Content-Type':'application/json'},body: JSON.stringify({text})}); alert('Submitted'); e.target.reset(); };
  document.getElementById('profile-form').onsubmit = async e=>{ e.preventDefault(); const f=new FormData(e.target); await fetch('/api/profile',{method:'POST',body:f}); alert('Updated'); load(); };
}
load();
</script>
</body></html>
